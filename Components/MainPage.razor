@page "/"
@inject AppState State
@inject IJSRuntime JSRuntime

<div class="nuclear-viewport">
    
    <div class="header-bar">
        <HeaderBar State="State" OnClear="StateHasChanged" />
    </div>

    <div class="scroll-container" @ref="_viewportRef">
        <div class="data-grid">
            @foreach (var eq in State.Equations)
            {
                <div class="grid-row" @key="eq.GetHashCode()">
                    <div class="cell equation">
                        <EquationRow Equation="eq" OnChanged="StateHasChanged" />
                    </div>

                    <div class="cell actions">
                        <button class="btn-delete" @onclick="() => State.RemoveEquation(eq)" title="Remove">
                            ✕
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="footer-bar">
        <button class="fab-add" @onclick="AddEquation">+</button>

        <div class="solve-wrapper">
            <SolutionComponent State="State"/>
        </div>
    </div>
</div>

@code {
    private ElementReference _viewportRef;

    private async Task AddEquation()
    {
        State.AddEquation();
        // Autoscroll down
        await Task.Delay(50); 
        await JSRuntime.InvokeVoidAsync("scrollToBottom", _viewportRef);
    }
}